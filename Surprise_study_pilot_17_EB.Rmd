---
title: "Surprise study pilot 17"
author: "Elena Bagdades"
date: "2024-02-29"
output: 
    pdf_document:
    toc: true
    toc_depth: 2
    toc_float: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(root.dir = "aim_lab_1", echo = TRUE)
```

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(lme4)
library(parameters)
library(broom.mixed)
library(purrr)
library(conflicted)
library(stringr)
library(readxl)
```


\newpage
# Study description

This study is the same as pilot 16, but we have now introduced a new block where there will be another peer observing and assessing the participants. However, they are told that the score of this second person will only be sent to us, so they will only see one rating from the original judges.There will be the same number of trials divided into two blocks with a counterbalanced order. Participants will see the picture and name of this second person on the upper left side of the screen, with the picture of the old judges in the middle. The goal is to increase the social pressure and see how it can change the relationship between mood/anxiety and subjective PE. This will strengthen our argument that our task is indeed social!

The Gorilla experiment is the following: https://app.gorilla.sc/admin/experiment/167771/design
The task is the following: https://app.gorilla.sc/admin/task/777911/editor


Note:Due to incorrect coding of the experiment on gorilla, there were no chocking and no_chocking blocks. Instead, this experiemnt had an event-related design (Randomized). Further, for some participants some anxiety and/or mood ratings were duplicated. This was easiest to fix manually in excel. The corrected excel file is called "CORRECT_SUP_PRF_p17_vid_bigPE_nar2_earlypred_chk_cbal_v4_task_main.csv". Please use this file for the following analysis. 

```{r echo=FALSE, warning=FALSE, message=FALSE}
df17_raw <- read.csv("/Users/Elena/OneDrive - University College London/Documents/GitHub/aim_lab_1/CORRECT_SUP_PRF_p17_vid_bigPE_nar2_earlypred_chk_cbal_v4_task_main.csv")
df17_spin <- read.csv("/Users/Elena/OneDrive - University College London/Documents/GitHub/aim_lab_1/SUP_PRF_p17_vid_bigPE_nar2_earlypred_chk_cbal/SUP_PRF_p17_vid_bigPE_nar2_earlypred_chk_cbal_v4/SUP_PRF_p17_vid_bigPE_nar2_earlypred_chk_cbal_v4_mini_spin.csv")
df17_cesd <- read.csv("/Users/Elena/OneDrive - University College London/Documents/GitHub/aim_lab_1/SUP_PRF_p17_vid_bigPE_nar2_earlypred_chk_cbal/SUP_PRF_p17_vid_bigPE_nar2_earlypred_chk_cbal_v4/SUP_PRF_p17_vid_bigPE_nar2_earlypred_chk_cbal_v4_ces_d.csv")
```


```{r echo=FALSE, warning=FALSE, message=FALSE}
# extract CES-D scores
CESD_data_clean <- df17_cesd[, c(33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,72)]
# Identify non-ID variable columns
non_id_cols <- setdiff(names(CESD_data_clean), "Random_ID")

# Convert non-ID variables to numeric
CESD_data_clean[, non_id_cols] <- lapply(CESD_data_clean[, non_id_cols], as.numeric)

#change numbers to match CES-D scoring system
excluded_columns <-  c("Random_ID", "Multiple.Choice.Grid.object.3.4...I.felt.I.was.just.as.good.as.other.people..Quantised",
                       "Multiple.Choice.Grid.object.3.8...I.felt.hopeful.about.the.future..Quantised",
                       "Multiple.Choice.Grid.object.3.12...I.was.happy..Quantised",
                       "Multiple.Choice.Grid.object.3.16...I.enjoyed.life..Quantised")


# numbers_plus_one <- c(33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 72)
# 
# # Extract the column names using the indices
# column_names <- colnames(df17_cesd)[numbers_plus_one]
# 
# # Print the column names
# print(column_names)

CESD_data_clean<- CESD_data_clean %>%
  mutate(across(-excluded_columns , ~ case_when(
    . == 1 ~ 0,
    . == 2 ~ 1,
    . == 3 ~ 2,
    . == 4 ~ 3,
    TRUE ~ .
  )))


other_columns <- c("Multiple.Choice.Grid.object.3.4...I.felt.I.was.just.as.good.as.other.people..Quantised",
                   "Multiple.Choice.Grid.object.3.8...I.felt.hopeful.about.the.future..Quantised",
                   "Multiple.Choice.Grid.object.3.12...I.was.happy..Quantised",
                   "Multiple.Choice.Grid.object.3.16...I.enjoyed.life..Quantised")
CESD_data_clean<- CESD_data_clean %>%
  mutate(across(other_columns , ~ case_when(
    . == 1 ~ 3,
    . == 2 ~ 2,
    . == 3 ~ 1,
    . == 4 ~ 0,
    TRUE ~ .
  )))

#scoring----
CESD_scores <-  numeric(length(CESD_data_clean$Random_ID))
CESD_scores <- 0
Questions <- c(1:20)

for (i in 1:nrow(CESD_data_clean)) {
  CESD_score <- sum(CESD_data_clean[i, Questions])
  CESD_scores[i] <- CESD_score
}

CESD_data_clean$CESD_score <-  CESD_scores

CESD_data_clean$Depression_Threshold<- 0
CESD_data_clean$Depression_status <- "Not_Depressed"

#Assign "1" if they meet Depression threshold 
for (i in 1:nrow(CESD_data_clean)) {
  if (CESD_data_clean$CESD_score[i] >= 17) {
    CESD_data_clean$Depression_Threshold[i] <- 1
    CESD_data_clean$Depression_status[i] <- "Depressed"
  }
}
```


```{r echo=FALSE, warning=FALSE, message=FALSE}

df17_spin <- df17_spin %>%
  rename(
   "Q1" =  "Rating.Scale.object.2.Fear.of.embarrassment.causes.me.to.avoid.doing.things.or.speaking.to.people.",
   "Q2" =  "Rating.Scale.object.2.I.avoid.activities.in.which.I.am.the.center.of.attention.",
   "Q3" = "Rating.Scale.object.2.Being.embarrassed.or.looking.stupid.are.among.my.worst.fears."
  )

df17_spin <- df17_spin %>%
  rowwise() %>%
  mutate(mini_SPIN_total = sum(c(Q1, Q2, Q3), na.rm = TRUE)) %>%
  ungroup()

```


```{r echo=FALSE, warning=FALSE, message=FALSE}

# create a new df17 that only keeps the columns we need
df17 <- df17_raw[, c("Display", "Screen", "Response.Type", "Response", 
                     "Reaction.Time", "Spreadsheet..Histogram", "Spreadsheet..Feedback","Random_ID")]
df17 <- df17 %>%
 mutate(Response = as.numeric(as.character(Response))) #%>%
#  dplyr::filter(!is.na(Response))

df17 <- df17 %>%
 dplyr::filter(Response.Type != "continue")

df17 <- df17 %>%
 dplyr::filter(Display== "Anxiety "| Display== "Mood " | Display== "Trials "| Display== "Trials-Chocking " )


sequence <-c(rep(c("0.1", "0.1", "0.2", "0.2", rep(1:48, each = 9)), 40))

# Add the sequence as a new column to df17
df17$New_Trial_Number <- sequence


#Add condition column 

df17$Condition <- ifelse(df17$Display == "Trials-Chocking ", "Chocking",
                         ifelse(df17$Display == "Trials ", "No_chocking",
                                ""))

df17 <- df17 %>%
  mutate(Display = ifelse(Display == "Trials-Chocking ", "Trials ", Display))

df17_raw_new_trials <- df17

df17 <- df17 %>%
 mutate(Response = as.numeric(as.character(Response))) %>%
dplyr::filter(!is.na(Response))


df17$m_hist <- ifelse(df17$Spreadsheet..Histogram == "h1.png", 20,
                      ifelse(df17$Spreadsheet..Histogram == "h2.png", 29,
                             ifelse(df17$Spreadsheet..Histogram == "h3.png", 37,
                                    ifelse(df17$Spreadsheet..Histogram == "h4.png", 46,
                                           ifelse(df17$Spreadsheet..Histogram == "h5.png", 54,
                                                  ifelse(df17$Spreadsheet..Histogram == "h6.png", 63,
                                                         ifelse(df17$Spreadsheet..Histogram == "h7.png", 71,
                                                                ifelse(df17$Spreadsheet..Histogram == "h8.png", 80, NA))))))))  


# get rid of the rows we don't need: practice runs, continue button presses etc. and only keep Trials, Anxiety and Mood that include all variables we are interested in:
df17 <- df17 %>%
  dplyr::filter(
    (Display == "Trials ") |
    (Response.Type == "tooEarly") |
    (Display == "Exit") |
    (Display == "Anxiety " & !New_Trial_Number %in% c("BL1", "BL2")) |
    (Display == "Mood " & !New_Trial_Number %in% c("BL1", "BL2"))
  )

df17 <- df17 %>%
  dplyr::filter(
    New_Trial_Number != "0.1" & New_Trial_Number != "0.2"
  )


library(purrr)



df17_sorted <- df17 %>%
  arrange(Random_ID, New_Trial_Number)

# renaming the feedback column to fdbk
names(df17)[names(df17) == 'Spreadsheet..Feedback'] <- 'fdbk'

# Now let's create columns for PE (fdbk-hist) and Subj_PE (fdbk_Prediction)

df17 <- df17 %>%
  mutate(Screen = ifelse(Screen == "Screen 2", "Prediction ", 
                         ifelse(Screen == "Screen 3", "Certainty rating ", Screen)))


df17$SubjPE <- ifelse(df17$Screen == "Prediction ", df17$fdbk - df17$Response, NA)
df17$PE <- ifelse(df17$Screen == "Prediction ", df17$fdbk - df17$m_hist, NA)
# to keep just one repetition of feedback and mean histogram per trial per subject 
# and replace the rest with NA so that when we want to convert to long format we won't have duplicates
df17$fdbk <- ifelse(df17$Screen == "Prediction ", df17$fdbk, NA)
df17$m_hist <- ifelse(df17$Screen == "Prediction " , df17$m_hist, NA)
#df17$stress_level <- ifelse(df17$Screen == "Screen 12", df17$Response, NA)



long_df17 <- df17 %>%
  select(Random_ID, New_Trial_Number, fdbk, m_hist, PE, SubjPE,Condition) %>%
  pivot_longer(cols = c(fdbk, m_hist, PE, SubjPE),
               names_to = "Screen",
               values_to = "Response")


# This will keep only the rows where 'Response' is not NA
long_df17 <- long_df17[!is.na(long_df17$Response), ]

# Selecting relevant columns from the original df17
df17 <- df17 %>%
  select(-c(fdbk, m_hist, PE, SubjPE))

# Binding the rows together
df17 <- bind_rows(df17, long_df17)

df17$Response <- as.numeric(df17$Response)

# looking at the relationship between PE and SubjPE
df17_PE <- subset(df17, Screen == "PE")
names(df17_PE)[names(df17_PE) == "Screen"] <- "Screen_PE"
names(df17_PE)[names(df17_PE) == "Response"] <- "Response_PE"

df17_SubjPE <- subset(df17, Screen == "SubjPE")
names(df17_SubjPE)[names(df17_SubjPE) == "Screen"] <- "Screen_SubjPE"
names(df17_SubjPE)[names(df17_SubjPE) == "Response"] <- "Response_SubjPE"

df17_fdbk <- subset(df17, Screen == "fdbk")
names(df17_fdbk)[names(df17_fdbk) == "Screen"] <- "Screen_fdbk"
names(df17_fdbk)[names(df17_fdbk) == "Response"] <- "Response_fdbk"

df17_hist <- subset(df17, Screen == "m_hist")
names(df17_hist)[names(df17_hist) == "Screen"] <- "Screen_m_hist"
names(df17_hist)[names(df17_hist) == "Response"] <- "Response_m_hist"

#df17_stress_level <- subset(df17, Screen == "Screen 12")
#names(df17_stress_level)[names(df17_stress_level) == "Screen"] <- "Screen_stress_level"
#names(df17_stress_level)[names(df17_stress_level) == "Response"] <- "Response_stress_level"

df17_predic <- subset(df17, Screen == "Prediction ")
names(df17_predic)[names(df17_predic) == "Screen"] <- "Screen_pred"
names(df17_predic)[names(df17_predic) == "Response"] <- "Response_pred"

df17_cert <- subset(df17, Screen == "Certainty rating ")
names(df17_cert)[names(df17_cert) == "Screen"] <- "Screen_certainty"
names(df17_cert)[names(df17_cert) == "Response"] <- "Response_certainty"

list_of_dfs_17 <- list(df17_PE, df17_fdbk, df17_hist, df17_predic, df17_cert, df17_SubjPE)

# Using reduce with inner_join
merged_df17 <- reduce(list_of_dfs_17, inner_join, by = c("Random_ID", "New_Trial_Number"))



df17_Anxious <- subset(df17, Screen == "Anxious")
names(df17_Anxious)[names(df17_Anxious) == "Screen"] <- "Screen_Ax"
names(df17_Anxious)[names(df17_Anxious) == "Response"] <- "Response_Ax"

df17_Happy <- subset(df17, Screen == "Happy")
# df17_fdbk <- subset(df17, Screen == "Prediction")
names(df17_Happy)[names(df17_Happy) == "Screen"] <- "Screen_H"
names(df17_Happy)[names(df17_Happy) == "Response"] <- "Response_H"

final_df17 <- merged_df17 %>%
  inner_join(df17_Anxious, by = c("Random_ID", "New_Trial_Number")) %>%
  inner_join(df17_Happy, by = c("Random_ID", "New_Trial_Number"))


# subset only the columns we are interested in
final_df17 <- final_df17[c("New_Trial_Number", "Random_ID", "Response_H", "Response_Ax", "Response_fdbk", "Response_SubjPE", "Response_PE", "Response_certainty", "Response_m_hist", "Response_pred", "Condition.y.y")]

final_df17 <- rename(final_df17, Condition = Condition.y.y)

final_df17 <- final_df17 %>%
  left_join(df17_spin %>% select(Random_ID, mini_SPIN_total), by = "Random_ID")

#final_df17 <- final_df17 %>%
  #left_join(df17_stress_level %>% select(Random_ID, Response_stress_level), by = "Random_ID")

final_df17 <- final_df17 %>%
  left_join(CESD_data_clean %>% select(Random_ID, CESD_score, Depression_Threshold, Depression_status), by = "Random_ID")

final_df17$Social_Anxiety <- ifelse(final_df17$mini_SPIN_total >= 6, "high", "low")


final_df17 %>%
  group_by(Random_ID) %>%
  summarise(New_Trial_Number = n())

print("It seems everyone has done all the 24 trials per block, everyone has also finished the task including the feedback page.")

#write.csv(final_df17, "C:/Users/Elena/Downloads/EB_pilot_17_variables.csv", row.names = FALSE)
```

\newpage 
# Relationship between prediction and mean histogram

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations <- final_df17 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_m_hist, Response_pred, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mean_hist and prediction:", average_correlation)

print(message_to_print_H)

ggplot(final_df17, aes(x = Response_m_hist, y = Response_pred, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("prediction") + 
  ylab("mean_histogram") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
# +
#   ylim(c(0, 100)) + 
#   scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
#   xlim(c(-100, 100)) + 
#   scale_x_continuous(breaks = seq(0, 100, by = 25), limits = c(0,100))
  
```

\newpage 
# Relationship between Anxiety and SubjPE ALL conditions


```{r echo=FALSE, warning=FALSE, message=FALSE}

correlations_Ax <- final_df17 %>%
  group_by(Random_ID,Condition) %>%
  summarise(correlation = cor(Response_Ax, Response_SubjPE, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 



correlations_Ax  %>%
  group_by(Condition) %>%
  summarise(mean_corr = mean(correlation, na.rm = T))


# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_Ax$correlation, na.rm = TRUE)
message_to_print_Ax <- paste("average correlation between anxiety and SubjPE:", average_correlation)

print(message_to_print_Ax)

ggplot(final_df17, aes(x = Response_SubjPE, y = Response_Ax, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("SubjPE: feedback - prediction") + 
  ylab("Anxiety") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_Ax, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
ylim(c(0, 100)) +
scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
xlim(c(-100, 100)) +
scale_x_continuous(breaks = seq(-80, 80, by = 50), limits = c(-80,80))
```

\newpage 
# Relationship between Mood and SubjPE


```{r echo=FALSE, warning=FALSE, message=FALSE}

correlations_M <- final_df17 %>%
  group_by(Random_ID, Condition) %>%
  summarise(correlation = cor(Response_H, Response_SubjPE, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 


correlations_M  %>%
  group_by(Condition) %>%
  summarise(mean_corr = mean(correlation, na.rm = T))



# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_M$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mood and SubjPE:", average_correlation)

print(message_to_print_H)

ggplot(final_df17, aes(x = Response_SubjPE, y = Response_H, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("SubjPE: feedback - prediction") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_M, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(-80, 80, by = 50), limits = c(-80,80))
  
```

\newpage 
# Relationship between Mood and feedback

The relationship between mood and feedback still seems to be stronger than mood and subjective PE. Is this a problem? How do we even differentiate social reward, from social PE?

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations_Mfd <- final_df17 %>%
  group_by(Random_ID,Condition) %>%
  summarise(correlation = cor(Response_H, Response_fdbk, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 


correlations_Mfd  %>%
  group_by(Condition) %>%
  summarise(mean_corr = mean(correlation, na.rm = T))

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_Mfd$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mood and feedback:", average_correlation)

print(message_to_print_H)

ggplot(final_df17, aes(x = Response_fdbk, y = Response_H, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Feedback") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_Mfd, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(0, 100, by = 25), limits = c(0,100))
  
```



\newpage 
# Relationship between Mood and prediction

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations <- final_df17 %>%
  group_by(Random_ID,Condition) %>%
  summarise(correlation = cor(Response_H, Response_pred, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

correlations  %>%
  group_by(Condition) %>%
  summarise(mean_corr = mean(correlation, na.rm = T))
# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mood and prediction:", average_correlation)

print(message_to_print_H)

ggplot(final_df17, aes(x = Response_pred, y = Response_H, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Prediction") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(0, 100, by = 25), limits = c(0,100))
  
```


\newpage 
# Relationship between Anxiety and prediction

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations_Axpred <- final_df17 %>%
  group_by(Random_ID,Condition) %>%
  summarise(correlation = cor(Response_Ax, Response_pred, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

correlations_Axpred  %>%
  group_by(Condition) %>%
  summarise(mean_corr = mean(correlation, na.rm = T))

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between anxiety and prediction:", average_correlation)

print(message_to_print_H)

ggplot(final_df17, aes(x = Response_pred, y = Response_Ax, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Prediction") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(0, 100, by = 25), limits = c(0,100))
  
```

\newpage 
# Relationship between Anxiety and feedback

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations_Axfd <- final_df17 %>%
  group_by(Random_ID,Condition) %>%
  summarise(correlation = cor(Response_Ax, Response_fdbk, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 


correlations_Axfd  %>%
  group_by(Condition) %>%
  summarise(mean_corr = mean(correlation, na.rm = T))

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between anxiety and feedback:", average_correlation)

print(message_to_print_H)

ggplot(final_df17, aes(x = Response_fdbk, y = Response_Ax, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Feedback") + 
  ylab("Anxiety") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(0, 100, by = 25), limits = c(0,100))
  
```



```{r echo=FALSE, warning=FALSE, message=FALSE}
# trying to keep the BL_1 and BL_2 mood and anxiety ratings
df17_with_BL <- df17_raw_new_trials[, c("New_Trial_Number", "Display", "Screen", "Response.Type", "Response", 
                     "Reaction.Time", "Spreadsheet..Histogram", "Spreadsheet..Feedback", "Random_ID")]

df17_with_BL <- df17_with_BL %>%
  mutate(Response = as.numeric(as.character(Response))) %>%
  dplyr::filter(!is.na(Response))


df17_with_BL$m_hist <- ifelse(df17_with_BL$Spreadsheet..Histogram == "h1.png", 20,
                      ifelse(df17_with_BL$Spreadsheet..Histogram == "h2.png", 29,
                             ifelse(df17_with_BL$Spreadsheet..Histogram == "h3.png", 37,
                                    ifelse(df17_with_BL$Spreadsheet..Histogram == "h4.png", 46,
                                           ifelse(df17_with_BL$Spreadsheet..Histogram == "h5.png", 54,
                                                  ifelse(df17_with_BL$Spreadsheet..Histogram == "h6.png", 63,
                                                         ifelse(df17_with_BL$Spreadsheet..Histogram == "h7.png", 71,
                                                                ifelse(df17_with_BL$Spreadsheet..Histogram == "h8.png", 80, NA))))))))  


# get rid of the rows we don't need: practice runs, continue button presses etc. and only keep Trials, Anxiety and Mood that include all variables we are interested in:
df17_with_BL <- df17_with_BL %>%
  dplyr::filter(
    (Display == "Trials ") |
      (Display == "Anxiety ") |
      (Display == "Mood ")
  )


final_df17_with_BL <- df17_with_BL[c("New_Trial_Number", "Display", "Screen", "Response", "Random_ID")]

final_df17_with_BL <- final_df17_with_BL %>%
  left_join(df17_spin %>% select(Random_ID, mini_SPIN_total), by = "Random_ID")

final_df17_with_BL <- final_df17_with_BL %>%
  left_join(CESD_data_clean %>% select(Random_ID, CESD_score, Depression_Threshold, Depression_status), by = "Random_ID")

final_df17_with_BL$Social_Anxiety <- ifelse(final_df17_with_BL$mini_SPIN_total >= 6, "high", "low")
# Sample data frame

add_2_or_replace <- function(x) {
  ifelse(x == 0.1, "1", ifelse(x == 0.2, "2", x + 2))
}

final_df17_with_BL$New_Trial_Number <- as.numeric(final_df17_with_BL$New_Trial_Number )
# Apply the function to the column "New_Trial_Number"
final_df17_with_BL$New_Trial_Number <- add_2_or_replace(final_df17_with_BL$New_Trial_Number)

```



\newpage 
# Mood over time 


```{r echo=FALSE, warning=FALSE, message=FALSE}
df17_BL_ax <- subset(final_df17_with_BL, Display == "Anxiety ")
df17_BL_ax$New_Trial_Number <- as.numeric(df17_BL_ax$New_Trial_Number )

df17_BL_H <- subset(final_df17_with_BL,Display == "Mood ")
df17_BL_H$New_Trial_Number <- as.numeric(df17_BL_H$New_Trial_Number )

ggplot(df17_BL_H, aes(x = New_Trial_Number, y = Response, color = Display, group = Display)) +
  geom_line(color = "blue") +
  geom_vline(xintercept = 3, linetype = "dashed", color = "red") + # Adding a vertical line at Trial Number == 3 (which is actually trial 1)
  theme_minimal() +
  labs(title = "Mood across time",
       x = "Trial Number",
       y = "Mood",
       color = "") +
  facet_wrap(~ Random_ID, ncol = 6) + 
  theme(strip.text = element_text(size = 6)) +  
  scale_x_continuous(breaks = seq(0, 50, by = 10), limits = c(1, 50)) +
  scale_y_continuous(breaks = seq(0, 100, by = 20), limits = c(0, 100))+
  theme(axis.text.x = element_text(size = 5),axis.text.y = element_text(size = 5))

```

\newpage 
# Anxiety over time 
```{r echo=FALSE, warning=FALSE, message=FALSE}
ggplot(df17_BL_ax, aes(x = New_Trial_Number, y = Response, color = Display, group = Display)) +
geom_line(color = "blue") +
  geom_vline(xintercept = 3, linetype = "dashed", color = "red") + # Adding a vertical line at Trial Number == 3 (which is actually trial 1)
  theme_minimal() +
  labs(title = "Anxiety across time",
       x = "Trial Number",
       y = "Anxiety",
       color = "") +
  facet_wrap(~ Random_ID, ncol = 6) + 
  theme(strip.text = element_text(size = 6)) +  
  scale_x_continuous(breaks = seq(0, 50, by = 10), limits = c(1, 50)) +
  scale_y_continuous(breaks = seq(0, 100, by = 20), limits = c(0, 100))+
  theme(axis.text.x = element_text(size = 5),axis.text.y = element_text(size = 5))

```


\newpage
# LME models for Mood and SubjPE

When looking at subjective PE, the best model is  Mood ~ SubjPE + (SubjPE | Random_ID) with an AIC of 19784.67
When including feedback the best model is Mood ~ feedback  + (feedback | Random_ID) with an AIC of 19380.41
```{r echo=FALSE, warning=FALSE, message=FALSE}


model1 <- lme4::lmer(Response_H ~ Response_SubjPE + (1 | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))
model2 <- lme4::lmer(Response_H ~ Response_SubjPE + (Response_SubjPE | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))
model2a <- lme4::lmer(Response_H ~ Response_SubjPE + Response_fdbk + (Response_SubjPE | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))

AIC(model2)
AIC(model2a)

summary(model2)
summary(model2a)
anova(model2, model2a)

standard_beta_m2 <- parameters:: standardise_parameters (model2)
standard_beta_m2a <- parameters:: standardise_parameters (model2a)

model<- lme4::lmer(Response_H ~ Response_SubjPE * Condition + (1 | Random_ID), data = final_df17, control = lmerControl(optimizer = "bobyqa"))

model1 <- lme4::lmer(Response_H ~ Response_SubjPE + (1 | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))
model2 <- lme4::lmer(Response_H ~ Response_SubjPE + (Response_SubjPE | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))
model3 <- lme4::lmer(Response_H ~ Response_SubjPE * mini_SPIN_total + (Response_SubjPE | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))

model4 <- lme4::lmer(Response_H ~ Response_fdbk + (1 | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))
model5 <- lme4::lmer(Response_H ~ Response_fdbk + (Response_fdbk | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))
model6 <- lme4::lmer(Response_H ~ Response_fdbk * mini_SPIN_total + (Response_fdbk | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))

print("Model summary: Response_H ~ Response_SubjPE + (1 | Random_ID)")
summary(model)

print("Model 1 summary: Response_H ~ Response_SubjPE + (1 | Random_ID)")
summary(model1)

print("Model 2 summary: Response_H ~ Response_SubjPE + (Response_SubjPE | Random_ID)")
summary(model2)

print("Model 3 summary: Response_H ~ Response_SubjPE * mini_SPIN_total + (Response_SubjPE | Random_ID) ")
summary(model3)

print("Model 4 summary: Response_H ~ Response_fdbk + (1 | Random_ID)")
summary(model4)

print("Model 5 summary: Response_H ~ Response_fdbk + (Response_fdbk | Random_ID)")
summary(model5)

print("Model 6 summary: Response_H ~ Response_fdbk * mini_SPIN_total + (Response_fdbk | Random_ID)")
summary(model6)

print("AIC model:")
AIC(model)
print("AIC model1:")
AIC(model1)
print("AIC model2:")
AIC(model2)
print("AIC model3:")
AIC(model3)
print("AIC model4:")
AIC(model4)
print("AIC model5:")
AIC(model5)
print("AIC model6:")
AIC(model6)

# anova(model2, model5)
# coef_fixed <- fixef(model3)
# intercept_Mood <- coef_fixed[1]
# slope_Mood <- coef_fixed[2]
# standard_beta_fdbk <- parameters:: standardise_parameters (model5)
# standard_beta_subjPE <- parameters:: standardise_parameters (model2)
# test <- model5 %>% broom.mixed::tidy("fixed") 
```

\newpage 
# Individual plots with LME for Mood with SubjPE
When looking at subjective PE, the best model is  Mood ~ SubjPE  + (SubjPE | Random_ID) with an AIC of 19784.67

```{r echo=FALSE, warning=FALSE, message=FALSE}

coef_fixed <- fixef(model2)
intercept_Mood <- coef_fixed[1]
slope_Mood <- coef_fixed[2]
standard_beta_subjPE <- parameters:: standardise_parameters (model2)

ggplot(final_df17, aes(x=Response_SubjPE, y=Response_H)) +
  geom_smooth(method = "lm", size = 0.5, se = FALSE, aes(group=Random_ID, color=Social_Anxiety)) +
  scale_color_manual(values = c("low" = "lightblue", "high" = "pink")) +
  geom_abline(intercept = intercept_Mood, slope = slope_Mood, color="purple", linetype="dashed", size=1) +
  xlab("Subjective PE") + 
  ylab("Mood") +
  ggtitle("Relationship between Mood and subjective PE",
          subtitle = paste("estimated slopes of the association in n = ", 
                           length(unique(final_df17$Random_ID))))+
  theme(plot.title = element_text(size=17), plot.subtitle = element_text(size = 10))+
  theme(legend.title = element_text(size = 9), legend.text = element_text(size = 8))+
  theme(axis.title = element_text(size = 10))+
  annotate("label", x = 32, y = 55, label = paste("beta = ", round(standard_beta_subjPE$Std_Coefficient[2],2), ", 95%CI = ",
                                                 round(standard_beta_subjPE$CI_low[2],2), "-", 
                                                 round(standard_beta_subjPE$CI_high[2],2))) 
  
```


\newpage 
# Individual plots with LME for Mood with feedback instead of SubjPE

When including feedback the best model is Mood ~ feedback  + (feedback | Random_ID) with an AIC of 19380.41

```{r echo=FALSE, warning=FALSE, message=FALSE}
coef_fixed <- fixef(model5)
intercept_Mood <- coef_fixed[1]
slope_Mood <- coef_fixed[2]
standard_beta_fdbk <- parameters:: standardise_parameters (model5)


ggplot(final_df17, aes(x=Response_fdbk, y=Response_H)) +
  geom_smooth(method = "lm", size = 0.5, se = FALSE, aes(group=Random_ID, color=Social_Anxiety)) +
  scale_color_manual(values = c("low" = "lightblue", "high" = "pink")) +
  geom_abline(intercept = intercept_Mood, slope = slope_Mood, color="purple", linetype="dashed", size=1) +
  xlab("Feedback") + 
  ylab("Mood") +
  ggtitle("Relationship between Mood and Feedback",
          subtitle = paste("estimated slopes of the association in n = ", 
                           length(unique(final_df17$Random_ID))))+
  theme(plot.title = element_text(size=17), plot.subtitle = element_text(size = 10))+
  theme(legend.title = element_text(size = 9), legend.text = element_text(size = 8))+
  theme(axis.title = element_text(size = 10))+
  annotate("label", x = 32, y = 55, label = paste("beta = ", round(standard_beta_fdbk$Std_Coefficient[2],2), ", 95%CI = ",
                                                 round(standard_beta_fdbk$CI_low[2],2), "-", 
                                                 round(standard_beta_fdbk$CI_high[2],2))) 

correlation <- final_df17 %>% 
  group_by(Social_Anxiety)%>% 
  cor.test(Response_Ax, Response_H)

correlations <- final_df17 %>%
  group_by(Social_Anxiety) %>%
  summarise(correlation = cor(Response_Ax, Response_H, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2)))
  
```

\newpage
# LME models for Anxiety and SubjPE

When looking at subjective PE, the best model is  Anxiety ~ SubjPE  + (SubjPE | Random_ID) with an AIC of 19691.4
When including feedback the best model is Anxiety ~ feedback  + (Random_ID) with an AIC of 19530.9

```{r echo=FALSE, warning=FALSE, message=FALSE}
model1 <- lme4::lmer(Response_Ax ~ Response_SubjPE + (1 | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))
model2 <- lme4::lmer(Response_Ax ~ Response_SubjPE + (Response_SubjPE | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))
model3 <- lme4::lmer(Response_Ax ~ Response_SubjPE * mini_SPIN_total + (Response_SubjPE | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))

model4 <- lme4::lmer(Response_Ax ~ Response_fdbk + (1 | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))
model5 <- lme4::lmer(Response_Ax ~ Response_fdbk + (Response_fdbk | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))
model6 <- lme4::lmer(Response_Ax ~ Response_fdbk * mini_SPIN_total + (Response_fdbk | Random_ID), data = final_df17, control=lmerControl(optimizer="bobyqa"))

print("Model 1 summary: Response_Ax ~ Response_SubjPE + (1 | Random_ID)")
summary(model1)

print("Model 2 summary: Response_Ax ~ Response_SubjPE + (Response_SubjPE | Random_ID)")
summary(model2)

print("Model 3 summary: Response_Ax ~ Response_SubjPE * mini_SPIN_total + (Response_SubjPE | Random_ID) ")
summary(model3)

print("Model 4 summary: Response_Ax ~ Response_fdbk + (1 | Random_ID)")
summary(model4)

print("Model 5 summary: Response_Ax ~ Response_fdbk + (Response_fdbk | Random_ID)")
summary(model5)

print("Model 6 summary: Response_Ax ~ Response_fdbk * mini_SPIN_total + (Response_fdbk | Random_ID)")
summary(model6)

print("AIC model1:")
AIC(model1)
print("AIC model2:")
AIC(model2)
print("AIC model3:")
AIC(model3)
print("AIC model4:")
AIC(model4)
print("AIC model5:")
AIC(model5)
print("AIC model6:")
AIC(model6)

# anova(model2, model5)

coef_fixed_subjPE <- fixef(model2)
intercept_ax_subjPE <- coef_fixed[1]
slope_ax_subjPE <- coef_fixed[2]

coef_fixed_fdbk <- fixef(model5)
intercept_ax_fdbk <- coef_fixed[1]
slope_ax_fdbk <- coef_fixed[2]

standard_beta_fdbk <- parameters:: standardise_parameters (model5)
standard_beta_subjPE <- parameters:: standardise_parameters (model2)
```


\newpage 
# Individual plots with LME for Anxiety with SubjPE
When looking at subjective PE, the best model is  Anxiety ~ SubjPE  + (SubjPE | Random_ID) with an AIC of 19691.4

```{r echo=FALSE, warning=FALSE, message=FALSE}

coef_fixed <- fixef(model2)
intercept_ax <- coef_fixed[1]
slope_ax <- coef_fixed[2]
standard_beta_subjPE <- parameters:: standardise_parameters (model2)


ggplot(final_df17, aes(x=Response_SubjPE, y=Response_Ax)) +
  geom_smooth(method = "lm", size = 0.5, se = FALSE, aes(group=Random_ID, color=Social_Anxiety)) +
  scale_color_manual(values = c("low" = "lightblue", "high" = "pink")) +
  geom_abline(intercept = intercept_ax, slope = slope_ax, color="purple", linetype="dashed", size=1) +
  xlab("Subjective PE") + 
  ylab("Anxiety") +
  ggtitle("Relationship between Anxiety and subjective PE",
          subtitle = paste("estimated slopes of the association in n = ", 
                           length(unique(final_df17$Random_ID))))+
  theme(plot.title = element_text(size=17), plot.subtitle = element_text(size = 10))+
  theme(legend.title = element_text(size = 9), legend.text = element_text(size = 8))+
  theme(axis.title = element_text(size = 10))+
  annotate("label", x = 32, y = 55, label = paste("beta = ", round(standard_beta_subjPE$Std_Coefficient[2],2), ", 95%CI = ",
                                                 round(standard_beta_subjPE$CI_low[2],2), "-", 
                                                 round(standard_beta_subjPE$CI_high[2],2))) 
  
```


\newpage 
# Individual plots with LME for Anxiety with feedback instead of SubjPE

When including feedback the best model is Anxiety ~ feedback  + (Random_ID) with an AIC of 8761.136

```{r echo=FALSE, warning=FALSE, message=FALSE}

coef_fixed <- fixef(model5)
intercept_ax <- coef_fixed[1]
slope_ax <- coef_fixed[2]
standard_beta_fdbk <- parameters:: standardise_parameters (model5)


ggplot(final_df17, aes(x=Response_fdbk, y=Response_Ax)) +
  geom_smooth(method = "lm", size = 0.5, se = FALSE, aes(group=Random_ID, color=Social_Anxiety)) +
  scale_color_manual(values = c("low" = "lightblue", "high" = "pink")) +
  geom_abline(intercept = intercept_ax, slope = slope_ax, color="purple", linetype="dashed", size=1) +
  xlab("Feedback") + 
  ylab("Anxiety") +
  ggtitle("Relationship between Anxiety and Feedback",
          subtitle = paste("estimated slopes of the association in n = ", 
                           length(unique(final_df17$Random_ID))))+
  theme(plot.title = element_text(size=17), plot.subtitle = element_text(size = 10))+
  theme(legend.title = element_text(size = 9), legend.text = element_text(size = 8))+
  theme(axis.title = element_text(size = 10))+
  annotate("label", x = 32, y = 55, label = paste("beta = ", round(standard_beta_fdbk$Std_Coefficient[2],2), ", 95%CI = ",
                                                 round(standard_beta_fdbk$CI_low[2],2), "-", 
                                                 round(standard_beta_fdbk$CI_high[2],2))) 
  
```


Anxiety over time (looking at chocking vs no_chocking)
```{r}
unique_ids <- unique(final_df17$Random_ID)

# Selecting the first 10 unique IDs
random_ids <- unique_ids[1:10]

# Subsetting the dataset with the selected IDs
final_df17_sample1 <- final_df17[final_df17$Random_ID %in% random_ids, ]

random_ids2 <- unique_ids[11:20]

# Subsetting the dataset with the selected IDs
final_df17_sample2 <- final_df17[final_df17$Random_ID %in% random_ids2, ]


ggplot(final_df17_sample2, aes(x = New_Trial_Number, y = Response_Ax, color = Condition)) +
  geom_point(aes(color=Condition, alpha = 0.3))  + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Trial Number") + 
  ylab("Anxiety") +
    facet_wrap(~ Random_ID, scales = "free") +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) 

```

Mood over time (looking at chocking vs no_chocking)
```{r}
unique_ids <- unique(final_df17$Random_ID)

# Selecting the first 10 unique IDs
random_ids <- unique_ids[1:10]

# Subsetting the dataset with the selected IDs
final_df17_sample1 <- final_df17[final_df17$Random_ID %in% random_ids, ]

random_ids2 <- unique_ids[11:20]

# Subsetting the dataset with the selected IDs
final_df17_sample2 <- final_df17[final_df17$Random_ID %in% random_ids2, ]


ggplot(final_df17_sample2, aes(x = New_Trial_Number, y = Response_H, color = Condition)) +
  geom_point(aes(color=Condition, alpha = 0.3))  + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Trial Number") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) 

```
